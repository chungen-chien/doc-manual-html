<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>遊戲中介工具 SDK 文件</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 這裡是針對新佈局的樣式調整 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0f172a; /* slate-900 */
            color: #cbd5e1; /* slate-300 */
        }
        .nav-link {
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            display: block;
            border-radius: 0.375rem; /* rounded-md */
        }
        .nav-link.active, .nav-link:hover {
            border-left-color: #2dd4bf; /* teal-400 */
            color: #f0fdfa; /* teal-50 */
            background-color: #1e293b; /* slate-800 */
        }
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        .content-section.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .api-list-item.active {
            background-color: #1e293b; /* slate-800 */
            color: #5eead4; /* teal-300 */
            font-weight: 500;
        }
        .flowchart-wrapper {
            background-color: #020617; /* slate-950 */
            padding: 2rem;
            border-radius: 0.5rem;
            border: 1px solid #1e293b; /* slate-800 */
            overflow-x: auto;
        }
        .flow-step {
            border: 1px solid #334155; /* slate-700 */
            background-color: #1e293b; /* slate-800 */
            color: #e2e8f0; /* slate-200 */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            text-align: center;
            min-width: 180px;
            z-index: 10;
            position: relative;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .flow-step:hover {
            border-color: #2dd4bf; /* teal-400 */
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            transform: translateY(-3px);
        }
        .flow-arrow {
            position: relative;
            width: 2px;
            height: 40px; /* Space between steps */
            background-color: #334155; /* slate-700 */
            margin: 0 auto;
            z-index: 1;
        }
        .flow-arrow::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 8px solid #334155; /* slate-700 */
        }
        .release-tag {
            font-size: 0.75rem;
            padding: 0.125rem 0.5rem;
            border-radius: 9999px;
            font-weight: 500;
        }
        .tag-feature { background-color: #059669; color: #ecfdf5; } /* emerald-600 */
        .tag-improvement { background-color: #2563eb; color: #dbeafe; } /* blue-600 */
        .tag-initial { background-color: #4f46e5; color: #e0e7ff; } /* indigo-600 */
        .code-block-wrapper {
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #334155; /* slate-700 */
            color: #e2e8f0; /* slate-200 */
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .copy-btn:hover {
            background-color: #475569; /* slate-600 */
        }
    </style>
</head>
<body class="antialiased">

    <div class="min-h-screen">
        <!-- Header: 這部分保持不變 -->
        <header class="bg-slate-900/80 backdrop-blur-sm border-b border-slate-700/50 sticky top-0 z-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <h1 class="text-2xl sm:text-4xl font-bold text-teal-400">遊戲中介工具 SDK 文件</h1>
            </div>
        </header>

        <!-- 主要佈局容器: 使用 flex 將導覽和主內容並排 -->
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row">
            <!-- Navigation: 移至左側，並設定為 sticky -->
            <nav class="w-full md:w-60 lg:w-64 flex-shrink-0 md:sticky md:top-24 md:self-start md:py-8 md:pr-8">
                <div class="flex flex-row md:flex-col md:space-y-1 p-4 md:p-0 overflow-x-auto">
                    <a href="#" class="nav-link active flex-shrink-0 py-2 px-3 text-sm sm:text-base font-medium text-slate-400" data-target="overview">總覽</a>
                    <a href="#" class="nav-link flex-shrink-0 py-2 px-3 text-sm sm:text-base font-medium text-slate-400" data-target="architecture">核心架構</a>
                    <a href="#" class="nav-link flex-shrink-0 py-2 px-3 text-sm sm:text-base font-medium text-slate-400" data-target="api">API 參考</a>
                    <a href="#" class="nav-link flex-shrink-0 py-2 px-3 text-sm sm:text-base font-medium text-slate-400" data-target="flows">核心流程</a>
                    <a href="#" class="nav-link flex-shrink-0 py-2 px-3 text-sm sm:text-base font-medium text-slate-400" data-target="integration">整合指南</a>
                    <a href="#" class="nav-link flex-shrink-0 py-2 px-3 text-sm sm:text-base font-medium text-slate-400" data-target="errors">錯誤碼參考</a>
                    <a href="#" class="nav-link flex-shrink-0 py-2 px-3 text-sm sm:text-base font-medium text-slate-400" data-target="releases">發布說明</a>
                </div>
            </nav>

            <!-- Main Content: 佔用剩餘空間 -->
            <main class="flex-grow px-4 sm:px-6 lg:px-0 md:py-8">
                
                <!-- Overview Section -->
                <section id="overview" class="content-section active">
                    <div class="bg-slate-800 p-6 sm:p-8 rounded-lg border border-slate-700">
                        <h2 class="text-2xl font-bold text-teal-400 mb-4">SDK 商業邏輯與價值</h2>
                        <p class="text-slate-400 leading-relaxed mb-6">
                            本節闡述了遊戲中介軟體 SDK 的核心商業價值。其目標是作為連接遊戲前端與後端服務的橋樑，將複雜的底層技術抽象化，從而讓開發團隊能夠專注於創造卓越的遊戲體驗，同時確保產品的穩定性、安全性與可擴展性。
                        </p>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-700">
                                <h3 class="font-bold text-slate-200 mb-2">🚀 簡化開發流程</h3>
                                <p class="text-sm text-slate-400">封裝複雜的網路通訊、資料處理等底層邏輯，讓開發者能專注於遊戲玩法與使用者體驗，大幅縮短開發週期。</p>
                            </div>
                            <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-700">
                                <h3 class="font-bold text-slate-200 mb-2">🛡️ 確保資料一致性與安全性</h3>
                                <p class="text-sm text-slate-400">透過標準化協定與錯誤處理，確保玩家餘額、遊戲結果等交易資料在傳輸時的準確性與完整性，降低風險。</p>
                            </div>
                            <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-700">
                                <h3 class="font-bold text-slate-200 mb-2">🎮 提升使用者體驗</h3>
                                <p class="text-sm text-slate-400">支援實時互動、內建斷線重連機制與即時事件通知，提供流暢、不中斷的遊戲體驗，增強玩家的投入感。</p>
                            </div>
                            <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-700">
                                <h3 class="font-bold text-slate-200 mb-2">🧩 支援多樣化遊戲功能</h3>
                                <p class="text-sm text-slate-400">模組化設計易於擴展，能快速支援會話管理、彩金系統、玩家資產管理等多樣化的遊戲功能需求。</p>
                            </div>
                            <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-700">
                                <h3 class="font-bold text-slate-200 mb-2">🔧 易於維護與升級</h3>
                                <p class="text-sm text-slate-400">核心通訊邏輯集中在 SDK 中，當後端服務升級時，僅需更新 SDK，大幅減少對遊戲客戶端的修改。</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Architecture Section -->
                <section id="architecture" class="content-section">
                    <div class="bg-slate-800 p-6 sm:p-8 rounded-lg border border-slate-700">
                        <h2 class="text-2xl font-bold text-teal-400 mb-2">核心架構</h2>
                        <p class="text-slate-400 leading-relaxed mb-6">本 SDK 採用模組化設計，將複雜的功能拆解為幾個獨立且專注的核心模組。這種設計提高了可維護性與擴展性，讓各個部分能高效協同工作，為遊戲客戶端提供穩定且高效的後端通訊能力。</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="p-5 border-l-4 border-teal-400 bg-teal-400/10 rounded-r-lg">
                                <h3 class="text-lg font-bold text-teal-300">`GSMiddleware.ts` (核心)</h3>
                                <p class="mt-1 text-sm text-teal-400/80">作為 SDK 的主要入口點，封裝了所有高階 API，處理遊戲邏輯層的請求與事件分發。</p>
                            </div>
                            <div class="p-5 border-l-4 border-sky-400 bg-sky-400/10 rounded-r-lg">
                                <h3 class="text-lg font-bold text-sky-300">`ConnectManager.ts` (連線管理)</h3>
                                <p class="mt-1 text-sm text-sky-400/80">負責 WebSocket/STOMP 連線的建立、維護、斷線偵測、自動重連及訊息的發送與訂閱。</p>
                            </div>
                            <div class="p-5 border-l-4 border-amber-400 bg-amber-400/10 rounded-r-lg">
                                <h3 class="text-lg font-bold text-amber-300">`EventHandler.ts` (事件處理)</h3>
                                <p class="mt-1 text-sm text-amber-400/80">提供全局事件發布與訂閱機制，確保 SDK 內部模組和遊戲客戶端能透過標準事件進行通訊。</p>
                            </div>
                            <div class="p-5 border-l-4 border-red-400 bg-red-400/10 rounded-r-lg">
                                <h3 class="text-lg font-bold text-red-300">`MessageHandler.ts` (訊息處理)</h3>
                                <p class="mt-1 text-sm text-red-400/80">處理與父容器 (iframe) 之間的 `postMessage` 通訊，用於特殊訊息（如重連票據更新）。</p>
                            </div>
                            <div class="p-5 border-l-4 border-indigo-400 bg-indigo-400/10 rounded-r-lg">
                                <h3 class="text-lg font-bold text-indigo-300">`index.ts` (入口/導出)</h3>
                                <p class="mt-1 text-sm text-indigo-400/80">作為 SDK 的主要導出檔案，定義了對外暴露的介面、常量和類別，方便遊戲客戶端導入。</p>
                            </div>
                            <div class="p-5 border-l-4 border-purple-400 bg-purple-400/10 rounded-r-lg">
                                <h3 class="text-lg font-bold text-purple-300">`utils` (工具)</h3>
                                <p class="mt-1 text-sm text-purple-400/80">包含常量、介面和錯誤代碼，提供統一的數據結構和通訊規範，確保各模組之間數據的一致性。</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- API Reference Section -->
                <section id="api" class="content-section">
                    <div class="bg-slate-800 p-6 sm:p-8 rounded-lg border border-slate-700">
                        <h2 class="text-2xl font-bold text-teal-400 mb-2">API 參考</h2>
                        <p class="text-slate-400 leading-relaxed mb-6">此處為 SDK 的詳細 API 文件。點擊左側列表中的方法以查看其詳細說明、參數和程式碼範例。所有範例都提供了「複製」按鈕，以方便您在開發中快速使用。</p>
                        <div class="flex flex-col md:flex-row gap-6">
                            <div class="md:w-1/3 lg:w-1/4">
                                <ul id="api-list" class="bg-slate-800/50 rounded-lg border border-slate-700 overflow-hidden"></ul>
                            </div>
                            <div id="api-detail" class="md:w-2/3 lg:w-3/4 flex-1"></div>
                        </div>
                    </div>
                </section>

                <!-- Flows Section -->
                <section id="flows" class="content-section">
                     <div class="bg-slate-800 p-6 sm:p-8 rounded-lg border border-slate-700">
                        <h2 class="text-2xl font-bold text-teal-400 mb-2">核心流程</h2>
                        <p class="text-slate-400 leading-relaxed mb-6">本節透過步驟化說明，幫助您理解 SDK 的核心運作機制，包括初始化連線、登入以及斷線重連等關鍵循環。</p>
                        
                        <h3 class="text-xl font-bold text-slate-200 mb-6 text-center">4.1 SDK 初始化與連線流程</h3>
                        <div class="flowchart-wrapper flex flex-col items-center">
                            <div class="flow-step">1. 遊戲啟動與 SDK 實例化</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">2. 發起連線請求 (mySDK.connect())</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">3. 建立底層連線 (WebSocket & STOMP)</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">4. SDK 內部訂閱</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">5. 連線成功通知 (Connection 事件)</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">6. 連線失敗處理 (ConnectionLost 事件)</div>
                        </div>

                        <h3 class="text-xl font-bold text-slate-200 mb-6 mt-12 text-center">4.2 登入流程</h3>
                        <div class="flowchart-wrapper flex flex-col items-center">
                            <div class="flow-step">1. 發起登入請求 (mySDK.login())</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">2. 判斷登入類型並發送請求</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">3. 伺服器處理與回應 (loginResponse)</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">4. SDK 處理回應與事件廣播 (Login / LoginError 事件)</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">5. 遊戲處理登入結果</div>
                        </div>

                        <h3 class="text-xl font-bold text-slate-200 mb-6 mt-12 text-center">4.3 斷線與重新連線流程</h3>
                        <div class="flowchart-wrapper flex flex-col items-center">
                            <div class="flow-step">1. 偵測連線中斷 (onStompError / onDisconnect)</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">2. 廣播連線中斷事件 (ConnectionLost 事件)</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">3. 遊戲觸發重連 (mySDK.reconnect() - 可選)</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">4. 啟動內部重連機制</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">5. 處理重連結果 (Connection / Error 事件)</div>
                            <div class="flow-arrow"></div>
                            <div class="flow-step">6. 遊戲處理後續邏輯</div>
                        </div>
                    </div>
                </section>

                <!-- Integration Guide Section -->
                <section id="integration" class="content-section">
                    <div class="bg-slate-800 p-6 sm:p-8 rounded-lg border border-slate-700">
                        <h2 class="text-2xl font-bold text-teal-400 mb-2">整合指南 / 快速入門</h2>
                        <p class="text-slate-400 leading-relaxed mb-6">本節將引導您如何在遊戲專案中快速整合並開始使用 SDK。我們將以一個完整的「連線 -> 登入 -> 發送初始化請求」流程作為範例，並提供最佳實踐建議。</p>
                        
                        <h3 class="text-xl font-bold text-slate-200 mb-4">6.1 步驟概覽</h3>
                        <ol class="list-decimal list-inside text-slate-200 space-y-2 mb-8">
                            <li><b>環境準備</b>：確保您的開發環境符合 SDK 的前置條件。</li>
                            <li><b>導入 SDK</b>：將編譯好的 SDK 檔案導入到您的遊戲專案中。</li>
                            <li><b>初始化 SDK</b>：建立 <code>GSMiddleware</code> 實例並配置連線參數。</li>
                            <li><b>監聽事件</b>：註冊必要的事件監聽器，以接收 SDK 的回調。</li>
                            <li><b>建立連線</b>：呼叫 <code>connect()</code> 方法與伺服器建立連線。</li>
                            <li><b>執行登入</b>：在連線成功後，發送登入請求。</li>
                            <li><b>發送初始化指令</b>：登入成功後，發送遊戲初始化指令。</li>
                        </ol>

                        <h3 class="text-xl font-bold text-slate-200 my-4">6.2 逐步整合範例</h3>
                        <p class="text-slate-400 mb-4">假設您正在開發一個基於 TypeScript 的遊戲，以下是一個簡化的程式碼範例，展示如何將 SDK 整合到您的遊戲邏輯中：</p>
                        <div class="code-block-wrapper">
                            <pre class="bg-slate-900/70 text-white p-4 rounded-lg text-sm overflow-x-auto"><code>// 假設這是您的遊戲主腳本或入口點
import { GSMiddleware, GSM } from "./path/to/your/sdk/index.js"; // 請根據實際路徑調整

class GameClient {
    private mySDK: GSMiddleware;
    private gameConfig: any; // 您的遊戲配置

    constructor() {
        // 1. 準備 SDK 配置
        this.gameConfig = {
            host: 'your-game-server.com', // 替換為您的實際伺服器地址
            port: 8080,                   // 替換為您的實際伺服器端口
            uidA: 'player_unique_id_123', // 替換為實際玩家唯一ID
            userName: 'TestPlayer',       // 替換為實際玩家名稱
            gameLoginName: 'gameLogin',   // 或 'testGameLogin' 根據您的需求
            sessionID3: 'session_id_abc', // 替換為實際sessionID3
            gameType: 1,
            gameId: 1001,
            jackpotGroup: 'default_jp_group'
        };

        // 2. 初始化 SDK
        this.mySDK = new GSMiddleware(this.gameConfig);

        // 3. 註冊事件監聽器
        this.registerSDKEvents();

        // 4. 啟動連線
        this.mySDK.connect();
    }

    private registerSDKEvents(): void {
        // 監聽連線事件
        this.mySDK.addEventListener(GSM.Event.Connection, this.onConnection.bind(this));
        this.mySDK.addEventListener(GSM.Event.ConnectionLost, this.onConnectionLost.bind(this));

        // 監聽登入事件
        this.mySDK.addEventListener(GSM.Event.Login, this.onLogin.bind(this));
        this.mySDK.addEventListener(GSM.Event.LoginError, this.onLoginError.bind(this));

        // 監聽指令回應 (用於 Spin, Settle, Init 等)
        this.mySDK.addEventListener(GSM.Event.Command, this.onCommand.bind(this));

        // 監聽錯誤事件
        this.mySDK.addEventListener(GSM.Event.Error, this.onError.bind(this));

        // 監聽餘額變更事件
        this.mySDK.addEventListener(GSM.Event.Balance, this.onBalance.bind(this));

        // 監聽彩金事件
        this.mySDK.addEventListener(GSM.Event.Jackpot, this.onJackpot.bind(this));
    }

    private onConnection(detail: GSM.IConnection): void {
        if (detail.success) {
            console.log('SDK 連線成功！準備登入...');
            // 5. 連線成功後，執行登入
            this.mySDK.login();
        } else {
            console.error('SDK 連線失敗！');
            // 處理連線失敗的邏輯，例如顯示錯誤訊息給玩家
        }
    }

    private onConnectionLost(detail: GSM.IConnectionLost): void {
        console.warn('SDK 連線中斷！原因:', detail.reason);
        // 處理連線中斷的邏輯，例如顯示斷線訊息，並嘗試重新連線
        // this.mySDK.reconnect(); // 如果需要自動重連
    }

    private onLogin(data: GSM.ILogin): void {
        if (data.code === 0 && data.data) {
            console.log('玩家登入成功！玩家資訊:', data.entity);
            console.log('當前餘額:', data.entity.balance); // 假設登入回應中包含餘額
            // 6. 登入成功後，發送遊戲初始化指令
            this.mySDK.send(GSM.Request.Init, { commandType: GSM.Command.Init });
        } else {
            console.error('玩家登入失敗！訊息:', data.message, '錯誤碼:', data.code);
        }
    }

    private onLoginError(error: GSM.ILoginError): void {
        console.error('登入錯誤！錯誤訊息:', error.errorMessage, '錯誤碼:', error.errorCode);
        // 處理登入錯誤的邏輯
    }

    private onCommand(data: GSM.ICommand): void {
        console.log('收到指令回應:', data.cmd, '內容:', data.entity);
        switch (data.cmd) {
            case 'h5.initResponse':
                console.log('遊戲初始化完成！');
                // 遊戲初始化完成後的邏輯，例如顯示遊戲畫面
                break;
            case 'h5.spinResponse':
                console.log('收到 Spin 結果:', data.entity.spinResult);
                // 處理 Spin 結果，例如播放動畫
                break;
            case 'h5.settlePlayResponse':
                console.log('收到 Settle 結果:', data.entity.balance);
                // 處理 Settle 結果，例如更新餘額顯示
                break;
            // ... 處理其他指令回應
            default:
                console.log('未知指令回應:', data.cmd);
                break;
        }
    }

    private onError(error: GSM.IError): void {
        console.error('SDK 錯誤！', error.entity.message, '錯誤碼:', error.entity.code);
        if (error.isForceDisconnect) {
            console.error('錯誤導致強制斷線！');
            // 處理強制斷線的邏輯
        }
    }

    private onBalance(data: GSM.IBalance): void {
        console.log('餘額更新！新餘額:', data.balance, '時間戳:', data.ts);
        // 更新遊戲中的餘額顯示
    }

    private onJackpot(data: GSM.IJackpot): void {
        console.log('收到 Jackpot 訊息:', data);
        // 處理 Jackpot 訊息，例如更新彩金池顯示或播放中獎動畫
    }

    // 範例：發送一個 Spin 請求
    public sendSpinRequest(betAmount: number, denom: number): void {
        if (this.mySDK.isConnected()) {
            const spinPayload = {
                commandType: GSM.Command.Spin,
                entity: {
                    operation: 'NormalSpin', // 或其他操作類型
                    playerBet: betAmount,
                    denom: denom,
                    // ... 其他 Spin 相關參數
                }
            };
            this.mySDK.send(GSM.Request.Spin, spinPayload);
            console.log('發送 Spin 請求...');
        } else {
            console.warn('SDK 未連線，無法發送 Spin 請求。');
        }
    }

    // 範例：發送一個 Settle 請求
    public sendSettleRequest(gameSeqNo: string): void {
        if (this.mySDK.isConnected()) {
            const settlePayload = {
                commandType: GSM.Command.Settle,
                entity: {
                    gameSeqNo: gameSeqNo,
                }
            };
            this.mySDK.send(GSM.Request.Settle, settlePayload);
            console.log('發送 Settle 請求...');
        } else {
            console.warn('SDK 未連線，無法發送 Settle 請求。');
        }
    }
}

// 在您的遊戲啟動時創建 GameClient 實例
// const game = new GameClient();
// 之後您可以透過 game 實例來觸發遊戲操作，例如：
// game.sendSpinRequest(100, 1);</code></pre>
                            <button class="copy-btn">複製</button>
                        </div>

                        <h3 class="text-xl font-bold text-slate-200 my-4">6.3 最佳實踐與注意事項</h3>
                        <ul class="list-disc list-inside text-slate-200 space-y-2">
                            <li><b>錯誤處理</b>：務必監聽 <code>GSM.Event.Error</code> 和 <code>GSM.Event.ConnectionLost</code> 事件，並實作適當的錯誤處理和重連邏輯，以提升遊戲的穩定性。</li>
                            <li><b>生命週期管理</b>：確保在遊戲關閉或切換場景時，正確呼叫 <code>mySDK.disconnect()</code> 以釋放資源。</li>
                            <li><b>配置管理</b>：將 SDK 的配置參數（如 <code>host</code>, <code>port</code>, <code>apiKey</code> 等）從程式碼中分離出來，例如儲存在配置文件或環境變數中，以便於不同環境的部署和管理。</li>
                            <li><b>非同步操作</b>：SDK 的連線和請求發送都是非同步操作，請確保您的遊戲邏輯能夠正確處理非同步回調。</li>
                            <li><b>日誌記錄</b>：在開發和測試階段，開啟詳細的日誌記錄，有助於診斷問題。在生產環境中，則應調整日誌級別以避免過多輸出。</li>
                            <li><b>效能考量</b>：對於高頻率的操作（如 Spin），應注意請求的頻率和數據量，避免造成伺服器或客戶端的負擔。</li>
                        </ul>
                    </div>
                </section>

                <!-- Error Codes Section -->
                <section id="errors" class="content-section">
                    <div class="bg-slate-800 p-6 sm:p-8 rounded-lg border border-slate-700">
                        <h2 class="text-2xl font-bold text-teal-400 mb-2">錯誤碼參考</h2>
                        <p class="text-slate-400 leading-relaxed mb-6">本節詳細說明了 SDK 可能回傳的錯誤碼，幫助您快速定位和解決問題。</p>
                        <div class="space-y-4">
                            <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-700">
                                <h3 class="font-bold text-slate-200">Code.DISCONNECT (1)</h3>
                                <p class="text-base text-slate-300"><b>描述</b>：連線已斷開</p>
                            </div>
                            <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-700">
                                <h3 class="font-bold text-slate-200">Code.CONNECT_FAIL (4)</h3>
                                <p class="text-base text-slate-300"><b>描述</b>：一開始的連線失敗</p>
                            </div>
                            <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-700">
                                <h3 class="font-bold text-slate-200">Code.SUBSCRIPTION_WITHOUT_CONNECT (901)</h3>
                                <p class="text-base text-slate-300"><b>描述</b>：未連線便訂閱</p>
                            </div>
                            <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-700">
                                <h3 class="font-bold text-slate-200">Code.DUPLICATE_SUBSCRIPTION (902)</h3>
                                <p class="text-base text-slate-300"><b>描述</b>：重複訂閱</p>
                            </div>
                            <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-700">
                                <h3 class="font-bold text-slate-200">Code.SUBSCRIPTION_JACKPOT_ERROR (903)</h3>
                                <p class="text-base text-slate-300"><b>描述</b>：彩金訂閱失敗</p>
                            </div>
                            <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-700">
                                <h3 class="font-bold text-slate-200">Code.BROADCAST_FAIL (904)</h3>
                                <p class="text-base text-slate-300"><b>描述</b>：廣播發生問題</p>
                            </div>
                            <div class="bg-slate-700/50 p-4 rounded-lg border border-slate-700">
                                <h3 class="font-bold text-slate-200">其他錯誤碼 (來自伺服器)</h3>
                                <p class="text-base text-slate-300"><b>描述</b>：當 `GSM.Event.Error` 事件觸發時，`IError.entity.code` 會包含來自伺服器的具體錯誤碼。</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Release Notes Section -->
                <section id="releases" class="content-section">
                    <div class="bg-slate-800 p-6 sm:p-8 rounded-lg border border-slate-700">
                        <h2 class="text-2xl font-bold text-teal-400 mb-2">發布說明</h2>
                        <p class="text-slate-400 leading-relaxed mb-6">此處記錄了 SDK 的版本歷史、新功能、改進和錯誤修復。</p>
                        <div id="release-notes-container" class="space-y-8">
                            <!-- Release notes will be dynamically inserted here -->
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');
            const apiList = document.getElementById('api-list');
            const apiDetail = document.getElementById('api-detail');
            const releaseNotesContainer = document.getElementById('release-notes-container');

            const apiData = {
                'GSMMiddleware(config: IConfig)':{
                    name: 'GSMMiddleware(config: IConfig)',
                    desc: 'SDK 的建構函式，用於初始化 SDK 並載入必要的配置。這是使用 SDK 的第一步。',
                    params:[
                        { name: 'config: IConfig', desc: '包含伺服器連線資訊、玩家 ID 等的配置物件。' },
                        { name: 'host?: string', desc: '伺服器主機位址。' },
                        { name: 'port?: number', desc: '伺服器端口。' },
                        { name: 'uidA?: string', desc: '玩家的唯一識別碼。' },
                        { name: 'userName?: string', desc: '玩家名稱。' },
                        { name: 'jackpotGroup?: string', desc: '彩金群組識別碼。' },
                        { name: 'gameType?: number', desc: '遊戲類型 ID。' },
                        { name: 'gameId?: number', desc: '遊戲 ID。' },
                        { name: 'gameLoginName?: string', desc: '遊戲登入名稱，用於判斷測試或正式登入。' },
                        { name: 'sessionID3?: string', desc: 'Game Sever所使用的內容。' },
                    ],
                    returns: '無。',
                    example: `import { GSMiddleware, GSM } from "./index.js";\n\nconst config = {\n  host: 'your-game-server.com',\n  port: 8080,\n  uidA: 'player123',\n  gameLoginName: 'gameLogin',\n  sessionID3: 'your-session-id',\n  gameType: 1,\n  gameId: 1001,\n  jackpotGroup: 'groupA'\n};\nconst mySDK = new GSMiddleware(config);`
                },
                'connect': {
                    name: 'connect(): void',
                    desc: '建立與遊戲伺服器之間的 WebSocket + STOMP 連線。連線成功或失敗會透過事件通知。',
                    params: [],
                    returns: '無。',
                    example: `mySDK.addEventListener(GSM.Event.Connection, (detail) => {\n  if (detail.success) {\n    console.log('連線成功！');\n  } else {\n    console.log('連線失敗！');\n  }\n});\nmySDK.connect();`
                },
                'disconnect': {
                    name: 'disconnect(): void',
                    desc: '主動斷開與伺服器的連線，並取消所有訂閱。',
                    params: [],
                    example: `// 在遊戲關閉或場景切換時呼叫\nmySDK.disconnect();`
                },
                'reconnect': {
                    name: 'reconnect(): Promise<void>',
                    desc: '當連線中斷時，嘗試重新建立連線。SDK 會自動重試最多 3 次，每次間隔 5 秒。',
                    params: [],
                    example: `mySDK.addEventListener(GSM.Event.ConnectionLost, () => {\n  console.log('連線中斷，嘗試重新連線...');\n  mySDK.reconnect();\n});`
                },
                'isConnected': {
                    name: 'isConnected(): boolean',
                    desc: '檢查當前 SDK 是否已成功連線到伺服器。',
                    params: [],
                    example: `if (mySDK.isConnected()) {\n  console.log('SDK 已連線');\n} else {\n  console.log('SDK 未連線');\n}`
                },
                'login': {
                    name: 'login(): void',
                    desc: '向伺服器發送玩家登入請求。根據配置中的 `gameLoginName` 判斷是測試登入還是正式登入。',
                    params: [],
                    example: `mySDK.addEventListener(GSM.Event.Login, (data) => console.log('登入成功:', data));\nmySDK.addEventListener(GSM.Event.LoginError, (error) => console.error('登入失敗:', error));\nmySDK.login();`
                },
                send: {
                    name: 'send(reqName: GSM.Request, body: any, headers?: StompHeaders): void',
                    desc: '向伺服器發送通用請求。用於發送遊戲指令，例如 Spin, Settle, Init, SetRNG 等。',
                    params: [
                        { name: 'reqName', type: 'GSM.Request', desc: '請求的目的地或類型。可選值：`GSM.Request.Login`, `GSM.Request.TestLogin`, `GSM.Request.Init`, `GSM.Request.Spin`, `GSM.Request.Settle`, `GSM.Request.SetRng`, `GSM.Request.Heartbeat`。' },
                        { name: 'body', type: 'any', desc: '請求的資料內容。其結構取決於 `reqName`。' },
                        { name: 'headers', type: 'StompHeaders?', desc: '可選的 STOMP 標頭。' }
                    ],
                    bodyDetails: `
                        <p class="text-sm text-slate-300 mt-2"><b>` + "`GSM.Request.Spin` 的 `body` 結構範例：</b></p>" + `
                        <pre class="bg-gray-700/70 text-white p-3 rounded-lg text-xs overflow-x-auto"><code>{
  commandType: GSM.Command.Spin,
  entity: {
    operation: string; // 例如 'NormalSpin'
    playerBet: number; // 玩家下注金額
    denom: number;     // 貨幣單位
    freeGameCard?: string; // 免費遊戲卡 ID (可選)
    freeSpinCard?: string; // 免費旋轉卡 ID (可選)
    // ... 其他與 Spin 相關的參數
  }
}</code></pre>
                        <p class="text-sm text-slate-300 mt-4"><b>` + "`GSM.Request.Init` 的 `body` 結構範例：</b></p>" + `
                        <pre class="bg-gray-700/70 text-white p-3 rounded-lg text-xs overflow-x-auto"><code>{
  commandType: GSM.Command.Init,
  entity: {} // 通常為空物件(不用帶入)
}</code></pre>
                        <p class="text-sm text-slate-300 mt-4"><b>` + "`GSM.Request.Settle` 的 `body` 結構範例：</b></p>" + `
                        <pre class="bg-gray-700/70 text-white p-3 rounded-lg text-xs overflow-x-auto"><code>{
  commandType: GSM.Command.Settle,
  entity: object {
    playerID: string; // 玩家ID
    sessionID: string; // session
    gameSeqNo: string; // 遊戲局號
  }
}</code></pre>
                        <p class="text-sm text-slate-300 mt-4"><b>` + "`GSM.Request.SetRng` 的 `body` 結構範例：</b></p>" + `
                        <pre class="bg-gray-700/70 text-white p-3 rounded-lg text-xs overflow-x-auto"><code>{
  commandType: GSM.Command.SetRng,
  entity: object {
    rng: number[]; // SetRng 的參數
  }
}</code></pre>
                    `,
                    example: `const spinPayload = {\n  commandType: GSM.Command.Spin,\n  entity: {\n    playerBet: 100,\n    denom: 1,\n    //... 其他與 Spin 相關的參數\n  }\n};\nmySDK.send(GSM.Request.Spin, spinPayload);`
                },
                addEventListener: {
                    name: 'addEventListener(eventName: string, callback: Function, context?: any): void',
                    desc: '註冊一個事件監聽器，以接收來自 SDK 或伺服器的通知。',
                    params: [
                        { name: 'eventName', type: 'string', desc: '要監聽的事件名稱。可選值：`GSM.Event.Connection`, `GSM.Event.ConnectionLost`, `GSM.Event.Login`, `GSM.Event.LoginError`, `GSM.Event.Command`, `GSM.Event.Jackpot`, `GSM.Event.Balance`, `GSM.Event.Maintenance`, `GSM.Event.Error`。' },
                        { name: 'callback', type: 'Function', desc: '事件觸發時執行的回呼函式，會接收事件詳情作為參數。' },
                        { name: 'context', type: 'any?', desc: '可選的回呼函式執行的上下文 (`this`)。' }
                    ],
                    callbackDetails: `
                        <p class="text-sm text-slate-300 mt-2"><b>` + "`ILogin` 的 `entity` 結構範例：</b></p>" + `
                        <pre class="bg-gray-700/70 text-white p-3 rounded-lg text-xs overflow-x-auto"><code>interface ILogin {
  cdoe: number;    // 登入回傳代碼
  data: boolean;   // 是否成功登入
  entity: any;     // 登入的資料內容
  message: string; // 登入回應的訊息
  ts: number;      // 時間戳記
}</code></pre>
                        <p class="text-sm text-slate-300 mt-4"><b>` + "`ICommand` 的 `entity` 結構範例：</b></p>" + `
                        <pre class="bg-gray-700/70 text-white p-3 rounded-lg text-xs overflow-x-auto"><code>
interface ICommand {
  cmd: string;  // 回應的訊息標頭
  code: string; // 回應代碼
  entity: and;  // 回應的內容
}</code></pre>
                    `,
                    example: `mySDK.addEventListener(GSM.Event.Balance, (evtParams: any) => {\n  console.log('新餘額: ' + data.balance);\n  this.sendNotification(evtParams.cmd, evtParams);\n}, this);`
                },
                removeEventListener: {
                    name: 'removeEventListener(eventName: string, callback: Function): void',
                    desc: '移除先前註冊的事件監聽器。',
                    params: [
                        { name: 'eventName', type: 'string', desc: '要移除監聽的事件名稱。' },
                        { name: 'callback', type: 'Function', desc: '要移除的回呼函式。' }
                    ],
                    example: `const myBalanceHandler = (data) => {};\nmySDK.addEventListener(GSM.Event.Balance, myBalanceHandler, this);\n\n// ... 稍後移除\nmySDK.removeEventListener(GSM.Event.Balance, myBalanceHandler);`
                }
            };

            const releaseNotesData = [
                {
                    version: "0.0.4",
                    date: "2025-08-05",
                    changes: [
                        { type: "improvement", text: "調整重連判斷時間，改為35秒" }
                    ]
                },
                {
                    version: "0.0.3",
                    date: "2025-07-03",
                    changes: [
                        { type: "feature", text: "新增完整的斷線與重新連線流程，包含自動重試機制。" },
                        { type: "feature", text: "新增 `SetRNG` 功能，允許客戶端設定亂數種子。" },
                        { type: "feature", text: "新增 `HeartBeat` 事件，用於維持連線。" },
                        { type: "improvement", text: "Spin 請求新增 `freeGameCard` 與 `freeSpinCard` 功能範例。" },
                        { type: "improvement", text: "調整打包輸出，`dist` 目錄現在只包含 `index.js` 和 `index.d.ts`。" }
                    ]
                },
                {
                    version: "0.0.2",
                    date: "2025-05-16",
                    changes: [
                        { type: "improvement", text: "`SettlePlay` 請求不再攜帶 `playerID` 及 `sessionID`，簡化請求參數。" },
                        { type: "feature", text: "新增 `Change Balance` 功能，伺服器可主動推播餘額變更。" },
                        { type: "feature", text: "新增完整的 `Jackpot` 流程，包含彩金池更新與中獎者推播。" },
                        { type: "feature", text: "新增 `Maintenance` 流程，用於處理伺服器維護狀態。" }
                    ]
                },
                {
                    version: "0.0.1",
                    date: "2025-04-15",
                    changes: [
                        { type: "feature", text: "新增 `Error` 流程，用於處理伺服器端錯誤。" },
                        { type: "feature", text: "新增 `Spin` 和 `Settle` 核心遊戲流程。" },
                        { type: "improvement", text: "統一調整專案內的所有名詞，使其更具一致性。" },
                        { type: "initial", text: "SDK 初版發布，包含基本的連線、登入和事件處理功能。" }
                    ]
                }
            ];

            // 頁籤切換邏輯
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('data-target');

                    navLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');

                    contentSections.forEach(section => {
                        if (section.id === targetId) {
                            section.classList.add('active');
                        } else {
                            section.classList.remove('active');
                        }
                    });
                });
            });

            // 渲染 API 列表和詳細內容
            function renderApiDetail(key) {
                const item = apiData[key];
                if (!item) return;
                let paramsHtml = '<p class="text-slate-400">無參數。</p>';
                if (item.params.length > 0) {
                    paramsHtml = item.params.map(p => `
                        <div class="flex items-start">
                            <code class="text-sm bg-gray-900 text-white-600 px-2 py-1 rounded">${p.name}</code>
                            <span class="text-sm text-zinc-300 mx-2">${p.type}</span>
                            <p class="text-sm text-zinc-400 flex-1">${p.desc}</p>
                        </div>
                    `).join('<div class="my-2 border-b border-stone-200"></div>');
                }
                apiDetail.innerHTML = `
                    <div class="space-y-4">
                        <h3 class="text-xl font-bold text-slate-200">${item.name}</h3>
                        <p class="text-slate-400">${item.desc}</p>
                        <div>
                            <h4 class="font-semibold text-slate-300">參數：</h4>
                            <div class="space-y-3 mt-3 mb-6">${paramsHtml}</div>
                        </div>
                        ${item.bodyDetails ? `<h4 class="font-bold text-slate-300 mb-3">` + "`body` 參數結構詳情</h4>" + `<div class="mb-6">${item.bodyDetails}</div>` : ''}
                        ${item.callbackDetails ? `<h4 class="font-bold text-slate-300 mb-3">` + "`callback` 參數詳情</h4>" + `<div class="mb-6">${item.callbackDetails}</div>` : ''}
                        <div>
                            <h4 class="font-semibold text-slate-300">範例：</h4>
                            <div class="code-block-wrapper mt-2">
                                <pre class="bg-slate-900/70 text-white p-4 rounded-lg text-sm overflow-x-auto"><code>${item.example}</code></pre>
                                <button class="copy-btn">複製</button>
                            </div>
                        </div>
                    </div>
                `;
                addCopyListeners();
            }

            function initApiReference() {
                if (!apiList) return;
                apiList.innerHTML = '';
                Object.keys(apiData).forEach((key, index) => {
                    const item = document.createElement('li');
                    item.innerHTML = `<a href="#" class="api-list-item block p-3 text-sm text-slate-300 hover:bg-slate-700/50" data-key="${key}">${apiData[key].name}</a>`;
                    apiList.appendChild(item);

                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        document.querySelectorAll('#api-list .api-list-item').forEach(el => el.classList.remove('active'));
                        e.target.classList.add('active');
                        renderApiDetail(key);
                    });
                    
                    if (index === 0) {
                        item.querySelector('a').classList.add('active');
                        renderApiDetail(key);
                    }
                });
            }

            // 渲染發布說明
            function renderReleaseNotes() {
                if (!releaseNotesContainer) return;
                const tagClasses = {
                    feature: 'tag-feature',
                    improvement: 'tag-improvement',
                    initial: 'tag-initial'
                };
                releaseNotesContainer.innerHTML = releaseNotesData.map(note => `
                    <div class="relative">
                        <div class="absolute left-0 h-full w-0.5 bg-slate-700"></div>
                        <div class="pl-6 relative">
                            <div class="absolute left-[-6px] top-1 w-3 h-3 bg-teal-500 rounded-full"></div>
                            <p class="text-sm text-slate-500">${note.date}</p>
                            <h3 class="text-lg font-bold text-slate-200">${note.version}</h3>
                            <ul class="mt-2 space-y-1">
                                ${note.changes.map(change => `
                                    <li class="flex items-center">
                                        <span class="release-tag mr-2 tag-${change.type}">${change.type === 'feature' ? '✨ 新功能' : change.type === 'improvement' ? '🚀 改進' : '🎉 初始版本'}</span>
                                        <span class="ml-3 text-slate-300 text-sm">${change.text}</span>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                `).join('');
            }

            // 複製按鈕功能
            function addCopyListeners() {
                document.querySelectorAll('.copy-btn').forEach(button => {
                    // 防止重複綁定
                    if (button.dataset.listenerAttached) return;
                    button.dataset.listenerAttached = 'true';

                    button.addEventListener('click', () => {
                        const pre = button.previousElementSibling;
                        const code = pre.querySelector('code');
                        const text = code.innerText;
                        
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        document.body.appendChild(textArea);
                        textArea.select();
                        try {
                            document.execCommand('copy');
                            button.innerText = '已複製!';
                            setTimeout(() => { button.innerText = '複製'; }, 2000);
                        } catch (err) {
                            console.error('無法複製文字: ', err);
                        }
                        document.body.removeChild(textArea);
                    });
                });
            }

            // 初始渲染
            initApiReference();
            renderReleaseNotes();
            addCopyListeners();
        });
    </script>
</body>
</html>
