<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mac èªéŸ³è½‰é€å­—ç¨¿æŒ‡å—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è¤‡è£½è‡ªåŸæª”æ¡ˆçš„å®Œæ•´ CSS æ¨£å¼ */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1F2937;
            color: #E5E7EB;
        }
        .master-detail-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        .master-panel {
            width: 310px;
            background-color: #111827;
            padding: 2rem;
            overflow-y: auto;
            flex-shrink: 0;
            border-right: 1px solid #374151;
        }
        .master-panel a {
            display: block;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: #D1D5DB;
            font-weight: 500;
            transition: background-color 0.2s, color 0.2s;
        }
        .master-panel a:hover {
            background-color: #374151;
            color: #6EE7B7;
        }
        .master-panel a.active {
            background-color: #6EE7B7;
            color: #1F2937;
            font-weight: 600;
        }
        .master-panel h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #6EE7B7;
            margin-top: 2rem;
            margin-bottom: 0.5rem;
        }
        .detail-panel {
            flex-grow: 1;
            padding: 2rem;
            overflow-y: auto;
        }
        .section-header {
            border-bottom: 2px solid #6EE7B7;
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }
        pre {
            background-color: #111827;
            color: #E5E7EB;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            position: relative;
        }
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background-color: #374151;
            color: #D1D5DB;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .copy-btn:hover {
            background-color: #4B5563;
        }
        code {
            font-family: monospace;
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="master-detail-container">
        <div class="master-panel shadow-xl">
            <h2 class="text-2xl font-bold text-teal-300 mb-6">å°è¦½</h2>
            <nav class="space-y-2">
                <h3>æ•™å­¸ (Tutorials)</h3>
                <a href="#prerequisites" class="active">1. å‰ç½®ä½œæ¥­</a>
                <a href="#environment-setup">2. å»ºç½®å°ˆå±¬ç’°å¢ƒ</a>
                <a href="#model-install">3. å®‰è£ Whisper æ¨¡å‹</a>
                <a href="#transcription">4. éŸ³æª”è½‰éŒ„èˆ‡å„ªåŒ–</a>
                <a href="#conclusion">5. çµèªèˆ‡å…¶ä»–ç”¨é€”</a>
            </nav>
        </div>

        <div class="detail-panel">
            <header class="py-6">
                <h1 class="text-4xl font-extrabold text-white mb-2">Mac èªéŸ³è½‰é€å­—ç¨¿æŒ‡å—ï¼šä½¿ç”¨çµ‚ç«¯æ©Ÿå¿«é€Ÿè½‰è­¯</h1>
                <p class="text-lg text-gray-400">
                    é€™ä»½æŒ‡å—å°‡å¸¶ä½ å¾é›¶é–‹å§‹ï¼Œä½¿ç”¨ Mac çµ‚ç«¯æ©Ÿå»ºç½®ä¸€å€‹å°ˆé–€çš„ç’°å¢ƒï¼Œç”¨ä¾†å°‡éŸ³è¨Šæª”æ¡ˆè½‰éŒ„æˆé€å­—ç¨¿ã€‚
                </p>
            </header>

            <section id="prerequisites" class="content-section active">
                <h2 class="section-header text-teal-300 text-3xl mb-4">1. å‰ç½®ä½œæ¥­</h2>
                <p class="text-gray-400 mb-2">
                    åœ¨é–‹å§‹ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆå®‰è£å…©å€‹é‡è¦çš„å·¥å…·ï¼š
                    <ul>
                        <li><strong class="text-white">Homebrew</strong> ï¼šMac ä¸Šçš„å¥—ä»¶ç®¡ç†å™¨ï¼Œå¯ä»¥å¹«æˆ‘å€‘è¼•é¬†å®‰è£å…¶ä»–è»Ÿé«”ã€‚</li>
                        <li><strong class="text-white">FFmpeg</strong> ï¼šä¸€å€‹å¼·å¤§çš„å½±éŸ³è™•ç†å·¥å…·ï¼Œè½‰è­¯éç¨‹éœ€è¦ç”¨å®ƒä¾†è™•ç†éŸ³æª”ã€‚</li>
                    </ul>
                </p>
                <p class="text-gray-400 mb-2">
                    åœ¨ä½ çš„ã€Œ çµ‚ç«¯æ©Ÿ ã€ä¸­ï¼Œä¾åºè¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤ä¾†å®‰è£ï¼š
                </p>
                <div class="relative">
                    <pre><code class="language-bash">/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
brew install ffmpeg</code></pre>
                    <button class="copy-btn">è¤‡è£½</button>
                </div>
            </section>

            <section id="environment-setup" class="content-section">
                <h2 class="section-header text-teal-300 text-3xl mb-4">2. å»ºç½®å°ˆå±¬ç’°å¢ƒ</h2>
                <p class="text-gray-400 mb-2">
                    ç‚ºäº†é¿å…èˆ‡ç³»çµ±å…§å»ºçš„ Python è¡çªï¼Œæˆ‘å€‘æœƒå»ºç«‹ä¸€å€‹ç¨ç«‹çš„è™›æ“¬ç’°å¢ƒï¼Œä¸¦æŒ‡å®šå®‰è£ <strong class="text-white">Python 3.11</strong> ç‰ˆæœ¬ã€‚
                </p>
                <div class="relative">
                    <pre><code class="language-bash">brew install python@3.11</code></pre>
                    <button class="copy-btn">è¤‡è£½</button>
                </div>
                <p class="text-gray-400 mb-2">
                    å»ºç«‹è™›æ“¬ç’°å¢ƒï¼š
                </p>
                <div class="relative">
                    <pre><code class="language-bash">python3.11 -m venv whisper_env</code></pre>
                    <button class="copy-btn">è¤‡è£½</button>
                </div>
                <p class="text-gray-400 mb-2">
                    å•Ÿå‹•è™›æ“¬ç’°å¢ƒï¼š ç•¶çµ‚ç«¯æ©Ÿå‰é¢å‡ºç¾ <span class="text-teal-300">(whisper_env)</span> æ™‚ï¼Œè¡¨ç¤ºä½ å·²æˆåŠŸå•Ÿå‹•ç’°å¢ƒã€‚
                </p>
                <div class="relative">
                    <pre><code class="language-bash">source whisper_env/bin/activate</code></pre>
                    <button class="copy-btn">è¤‡è£½</button>
                </div>
            </section>

            <section id="model-install" class="content-section">
                <h2 class="section-header text-teal-300 text-3xl mb-4">3. å®‰è£ Whisper æ¨¡å‹</h2>
                <p class="text-gray-400 mb-2">
                    ç¾åœ¨ï¼Œåœ¨é€™å€‹å°ˆå±¬çš„è™›æ“¬ç’°å¢ƒä¸­ï¼Œæˆ‘å€‘ä¾†å®‰è£æ ¸å¿ƒçš„è½‰è­¯å·¥å…· <strong class="text-white">OpenAI Whisper</strong> ã€‚
                </p>
                <div class="relative">
                    <pre><code class="language-bash">pip install openai-whisper</code></pre>
                    <button class="copy-btn">è¤‡è£½</button>
                </div>
            </section>

            <section id="transcription" class="content-section">
                <h2 class="section-header text-teal-300 text-3xl mb-4">4. éŸ³æª”è½‰éŒ„èˆ‡å„ªåŒ–</h2>
                <p class="text-gray-400 mb-2">
                    åœ¨è½‰è­¯ä¹‹å‰ï¼Œéœ€è¦å…ˆå°‡éŸ³æª”å„ªåŒ–ç‚ºé©åˆè¾¨è­˜çš„ <strong class="text-white">.wav</strong> æ ¼å¼ã€‚é€™ä¸€æ­¥å¾ˆé‡è¦ï¼Œå¯ä»¥å¤§å¹…æé«˜è½‰è­¯çš„æº–ç¢ºæ€§ã€‚è«‹å°‡æ‚¨çš„éŸ³æª” (ä¾‹å¦‚ 'my_audio.mp3' æˆ– 'my_audio.m4a') æ”¾åœ¨ä¸€å€‹æ–¹ä¾¿çš„ä½ç½®ï¼Œç„¶å¾Œä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤é€²è¡Œè½‰æ›ã€‚
                </p>
                <div class="relative">
                    <pre><code class="language-bash">ffmpeg -i "my_audio.mp3" -acodec pcm_s16le -ac 1 -ar 16000 "my_audio.wav"</code></pre>
                    <button class="copy-btn">è¤‡è£½</button>
                </div>
                <p class="font-bold text-gray-200 text-xl mt-4 mb-2">
                    æ–¹æ³•ä¸€ï¼š
                </p>
                <p class="text-gray-400 mb-2">
                    æ¥ä¸‹ä¾†ï¼Œä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤é€²è¡Œè½‰éŒ„ã€‚é€™è£¡çš„ '-l' åƒæ•¸æŒ‡å®šäº†èªè¨€ç‚ºã€Œä¸­æ–‡ã€ï¼Œ'--model' åƒæ•¸æŒ‡å®šäº†ä½¿ç”¨çš„æ¨¡å‹å¤§å°ã€‚
                </p>
                <div class="relative">
                    <pre><code class="language-bash">whisper "my_audio.wav" --language Chinese --model medium</code></pre>
                    <button class="copy-btn">è¤‡è£½</button>
                </div>
                <p class="text-gray-300 mt-2 mb-2">
                    å®Œæˆå¾Œï¼Œç³»çµ±æœƒè‡ªå‹•åœ¨åŒä¸€å€‹è³‡æ–™å¤¾ä¸­ç”¢ç”Ÿå¤šç¨®æ ¼å¼çš„é€å­—ç¨¿ï¼Œä¾‹å¦‚ '.txt' å’Œ '.vtt'ã€‚
                </p>
                <p class="font-bold text-gray-200 text-xl mt-4 mb-2">
                    æ–¹æ³•äºŒï¼š
                </p>
                <p class="text-gray-400 mb-2">
                    é€™é‚Šæä¾›pythonè½‰æª”ç¨‹å¼ä»£ç¢¼ï¼Œä½¿ç”¨ä»£ç¢¼åŸ·è¡Œã€‚ï¼ˆéœ€å…ˆå»ºç«‹æª”æ¡ˆï¼Œåœ¨ä¸‹æŒ‡ä»¤åŸ·è¡Œè©²æª”ï¼‰
                </p>
                <div class="relative">
                    <pre><code class="language-bash">python3 myTransfer.py</code></pre>
                    <button class="copy-btn">è¤‡è£½</button>
                </div>
                <p class="text-gray-300 mt-2 mb-2">
                    å®Œæˆå¾Œï¼Œç³»çµ±æœƒè‡ªå‹•åœ¨åŒä¸€å€‹è³‡æ–™å¤¾ä¸­ç”¢ç”Ÿ '.txt' æ ¼å¼çš„é€å­—ç¨¿ã€‚
                </p>
                <p class="text-gray-400 mb-2">
                    æä¾› python ç¨‹å¼ç¢¼
                </p>
                <div class="relative mt-2">
                    <pre><code class="language-bash"># myTransfer.py
import os
import sys
import math
import subprocess
import whisper
from tqdm import tqdm

# ---------- ä½¿ç”¨è€…è¨­å®š ----------
FILE_NAME = "part4" # ä¿®æ”¹æŒ‡å®šçš„éŸ³æª”åç¨±
AUDIO_FILE_NAME = FILE_NAME + ".wav"  # éŸ³æª”åç¨±
SEARCH_PATHS = [
    "/Users/chungen/record/meeting",
]
OUTPUT_TRANSCRIPT = FILE_NAME + ".txt"
LANGUAGE = "zh"
CHUNK_MINUTES = 10   # æ¯æ®µåˆ‡å‰² 10 åˆ†é˜
MODEL_SIZE = None    # åŸ·è¡Œæ™‚è©¢å•æ¨¡å‹å¤§å°

# ---------- å°‹æ‰¾éŸ³æª” ----------
AUDIO_FILE = None
for path in SEARCH_PATHS:
    full_path = os.path.join(path, AUDIO_FILE_NAME)
    if os.path.isfile(full_path):
        AUDIO_FILE = full_path
        break

if AUDIO_FILE is None:
    print(f"âŒ æ‰¾ä¸åˆ°éŸ³æª” '{AUDIO_FILE_NAME}'ï¼Œè«‹ç¢ºèª SEARCH_PATHS æ˜¯å¦æ­£ç¢º")
    sys.exit(1)

print(f"âœ… æ‰¾åˆ°éŸ³æª”ï¼š{AUDIO_FILE}")

# ---------- è©¢å•æ¨¡å‹ ----------
available_models = ["tiny", "base", "small", "medium", "large"]
print("\nè«‹é¸æ“‡ Whisper æ¨¡å‹å¤§å°ï¼š")
for i, m in enumerate(available_models, 1):
    print(f"{i}. {m}")
choice = input("è¼¸å…¥æ•¸å­— (é è¨­ 3=small): ").strip()
if choice.isdigit() and 1 <= int(choice) <= len(available_models):
    MODEL_SIZE = available_models[int(choice)-1]
else:
    MODEL_SIZE = "small"

print(f"ğŸ‘‰ ä½¿ç”¨æ¨¡å‹ï¼š{MODEL_SIZE}")

# ---------- è¼‰å…¥ Whisper ----------
print(f"æ­£åœ¨è¼‰å…¥ Whisper æ¨¡å‹ï¼š{MODEL_SIZE} ...")
whisper_model = whisper.load_model(MODEL_SIZE)

# ---------- å–å¾—éŸ³æª”é•·åº¦ ----------
def get_audio_duration(filename):
    """ä½¿ç”¨ ffprobe å–å¾—éŸ³æª”é•·åº¦ï¼ˆç§’ï¼‰"""
    result = subprocess.run(
        ["ffprobe", "-v", "error", "-show_entries",
            "format=duration", "-of",
            "default=noprint_wrappers=1:nokey=1", filename],
        stdout=subprocess.PIPE,
        stderr=subprocess.STDOUT
    )
    return float(result.stdout)

duration = get_audio_duration(AUDIO_FILE)
print(f"éŸ³æª”ç¸½é•·åº¦ï¼šç´„ {duration/60:.1f} åˆ†é˜")

# ---------- åˆ‡å‰²éŸ³æª”ä¸¦è¾¨è­˜ ----------
chunk_length = CHUNK_MINUTES * 60  # è½‰æˆç§’
num_chunks = math.ceil(duration / chunk_length)

print(f"æ­£åœ¨åˆ‡å‰²éŸ³æª”ï¼Œæ¯æ®µ {CHUNK_MINUTES} åˆ†é˜ï¼Œå…± {num_chunks} æ®µ...")
transcript = []

for i in tqdm(range(num_chunks), desc="è™•ç†é€²åº¦"):
    start_time = i * chunk_length
    end_time = min((i+1) * chunk_length, duration)
    chunk_file = f"chunk_{i:03d}.wav"

    # ä½¿ç”¨ ffmpeg æ“·å–ç‰‡æ®µ
    subprocess.run([
        "ffmpeg", "-y", "-i", AUDIO_FILE,
        "-ss", str(start_time), "-to", str(end_time),
        "-ar", "16000", "-ac", "1",
        chunk_file, "-loglevel", "quiet"
    ])

    # Whisper è¾¨è­˜
    result = whisper_model.transcribe(chunk_file, language=LANGUAGE)

    # é€è¡Œè¼¸å‡ºï¼ˆä¾ segmentsï¼‰
    lines = []
    for seg in result.get("segments", []):
        seg_start = seg["start"] + start_time
        seg_end = seg["end"] + start_time
        seg_text = seg["text"].strip()
        lines.append(f"[{seg_start/60:.1f}-{seg_end/60:.1f} åˆ†é˜] {seg_text}")

    transcript.extend(lines)
    os.remove(chunk_file)

# ---------- è¼¸å‡ºé€å­—ç¨¿ ----------
with open(OUTPUT_TRANSCRIPT, "w", encoding="utf-8") as f:
    for line in transcript:
        f.write(line + "\n")

print(f"ğŸ‰ å®Œæˆï¼é€å­—ç¨¿å·²è¼¸å‡ºï¼š{OUTPUT_TRANSCRIPT}")
                        </code></pre>
                    <button class="copy-btn">è¤‡è£½</button>
                </div>
            </section>

            <section id="conclusion" class="content-section">
                <h2 class="section-header text-teal-300 text-3xl mb-4">5. çµèªèˆ‡å…¶ä»–ç”¨é€”</h2>
                <p class="text-gray-400 mb-2">
                    æ­å–œä½ ï¼ç¾åœ¨ä½ å·²ç¶“æŒæ¡äº†ä½¿ç”¨ Mac çµ‚ç«¯æ©Ÿé€²è¡ŒèªéŸ³è½‰é€å­—ç¨¿çš„åŸºç¤æµç¨‹ã€‚ä½ å¯ä»¥æ ¹æ“šéœ€æ±‚èª¿æ•´æ¨¡å‹å¤§å°ï¼Œä¾‹å¦‚ä½¿ç”¨ 'tiny', 'base', 'small', 'medium', 'large'ï¼Œä¾†æ¬Šè¡¡è½‰è­¯é€Ÿåº¦èˆ‡æº–ç¢ºæ€§ã€‚
                </p>
                <p class="text-gray-400 mb-2">
                    é€™å€‹æ–¹æ³•ä¸åƒ…é©ç”¨æ–¼èªéŸ³è½‰æ–‡å­—ï¼Œä¹Ÿå¯ä»¥ç”¨æ–¼å½±ç‰‡ï¼Œåªéœ€å°‡å½±ç‰‡æª”æ¡ˆä½œç‚ºè¼¸å…¥ï¼ŒWhisper å°±æœƒè‡ªå‹•æå–éŸ³è¨Šé€²è¡Œè½‰éŒ„ã€‚
                </p>
            </section>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.master-panel a');
            const contentSections = document.querySelectorAll('.content-section');

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();

                    navLinks.forEach(nav => nav.classList.remove('active'));
                    contentSections.forEach(content => content.classList.remove('active'));

                    link.classList.add('active');

                    const targetId = link.getAttribute('href').substring(1);
                    const targetContent = document.getElementById(targetId);
                    if (targetContent) {
                        targetContent.classList.add('active');
                        document.querySelector('.detail-panel').scrollTop = 0;
                    }
                });
            });

            function addCopyListeners() {
                document.querySelectorAll('.copy-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const pre = button.previousElementSibling;
                        const code = pre.querySelector('code');
                        const text = code.innerText;
                        
                        const textArea = document.createElement('textarea');
                        textArea.value = text;
                        document.body.appendChild(textArea);
                        textArea.select();
                        try {
                            document.execCommand('copy');
                            button.innerText = 'å·²è¤‡è£½!';
                            setTimeout(() => { button.innerText = 'è¤‡è£½'; }, 2000);
                        } catch (err) {
                            console.error('ç„¡æ³•è¤‡è£½æ–‡å­—: ', err);
                            button.innerText = 'è¤‡è£½å¤±æ•—';
                        }
                        document.body.removeChild(textArea);
                    });
                });
            }
            addCopyListeners();
        });
    </script>
</body>
</html>
